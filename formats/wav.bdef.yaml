name: WAV
endianness: little
root: wav

enums:
  audio_format:
    - value: 1
      label: PCM
    - value: 2
      label: ADPCM
    - value: 3
      label: IEEE_FLOAT
    - value: 6
      label: ALAW
    - value: 7
      label: MULAW
    - value: 0xFFFE
      label: EXTENSIBLE

structs:
  wav:
    - name: riff_id
      type: ascii
      size: "4"
      expected: [0x52, 0x49, 0x46, 0x46]
    - name: file_size
      type: uint32
    - name: wave_id
      type: ascii
      size: "4"
      expected: [0x57, 0x41, 0x56, 0x45]
    - name: chunks
      type: struct
      struct: riff_chunk
      repeat: eof

  riff_chunk:
    - name: chunk_id
      type: ascii
      size: "4"
    - name: chunk_size
      type: uint32
    - name: data
      type: switch
      size: "{chunk_size}"
      switch_on: "{chunk_id}"
      cases:
        "'fmt '": fmt_chunk
        "'data'": data_chunk
        "'fact'": fact_chunk
        "'LIST'": list_chunk
      default: raw_data

  fmt_chunk:
    - name: audio_format
      type: uint16
      enum: audio_format
    - name: num_channels
      type: uint16
    - name: sample_rate
      type: uint32
    - name: byte_rate
      type: uint32
    - name: block_align
      type: uint16
    - name: bits_per_sample
      type: uint16
    - name: cb_size
      type: uint16
      if: "{audio_format != 1}"
      description: "拡張フォーマットデータのサイズ"
    - name: extra_format_bytes
      type: bytes
      size: "{cb_size}"
      if: "{audio_format != 1}"
      description: "非PCMフォーマット向けの拡張データ"

  data_chunk:
    - name: data
      type: bytes
      size: remaining
      description: "オーディオサンプルデータ"

  fact_chunk:
    - name: num_samples
      type: uint32
      description: "チャンネルあたりのサンプル数"

  list_chunk:
    - name: list_type
      type: ascii
      size: "4"
      description: "リストタイプ識別子（例: INFO）"
    - name: data
      type: bytes
      size: remaining
      description: "サブチャンク生データ"

  raw_data:
    - name: data
      type: bytes
      size: remaining
