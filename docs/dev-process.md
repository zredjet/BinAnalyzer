# 開発プロセス

## 概要

BinAnalyzerの機能追加・変更は、要望ドキュメント駆動で行う。
1件の要望に対して1つのドキュメントを作成し、設計→実装→テストのサイクルを回す。

## ディレクトリ構成

```
docs/
├── dev-process.md          # 本ドキュメント（開発プロセス定義）
├── requirements/
│   ├── _template.md        # 要望ドキュメントテンプレート
│   ├── REQ-001-dsl-validator.md
│   ├── REQ-002-bit-fields.md
│   └── ...
├── architecture.md         # アーキテクチャ（必要に応じて更新）
├── dsl-reference.md        # DSL仕様（必要に応じて更新）
└── parser-design.md        # パーサー設計詳細
```

## 要望ドキュメントの命名規則

```
REQ-{連番3桁}-{短縮名}.md
```

例: `REQ-001-dsl-validator.md`, `REQ-002-bit-fields.md`

## 開発サイクル

### Phase 1: 要望定義

要望ドキュメントを `_template.md` に基づいて作成する。

記載する内容:
- **背景・動機**: なぜこの機能が必要か
- **機能要件**: 追加・変更する機能の詳細（漏れなく）
- **受入条件**: この要望が「実装完了」と判断される具体的な根拠
- **影響範囲**: 変更が及ぶプロジェクト・ファイル

ステータスを `draft` → `ready` に変更して次のPhaseへ進む。

### Phase 2: 設計

要望ドキュメントの「設計メモ」セクションに記録する。

記録する内容:
- **設計方針**: 採用するアプローチとその理由
- **設計変更ポイント**: 既存コードへの影響、モデル変更、インタフェース変更
- **代替案**: 検討したが不採用とした案（理由付き）
- **懸念事項**: 実装時に注意すべき点

設計完了後、ステータスを `designing` → `approved` に変更。

### Phase 3: 実装

設計に基づいてコードを変更する。

- 実装中に設計変更が必要になった場合、要望ドキュメントの設計メモに追記する
- 実装中に発見した課題は「実装メモ」セクションに記録する

### Phase 4: テスト・検証

受入条件に基づいてテストを作成・実行する。

- 各受入条件に対応するテストが存在すること
- 既存テストが壊れていないこと（`dotnet test` 全通過）
- 必要に応じてドキュメント（dsl-reference.md 等）を更新

検証完了後、ステータスを `implementing` → `done` に変更。

### Phase 5: ドキュメント更新

機能追加・変更に伴い、以下を必要に応じて更新する:
- `docs/dsl-reference.md` — DSL構文の追加・変更
- `docs/architecture.md` — アーキテクチャへの影響
- `CLAUDE.md` — 開発者向け情報の更新
- `README.md` — ユーザー向け情報の更新

## ステータス遷移

```
draft → ready → designing → approved → implementing → done
                                                    ↘ blocked
```

- **draft**: 要望の初稿。内容の精査が未完了。
- **ready**: 要望内容が確定。設計開始可能。
- **designing**: 設計作業中。
- **approved**: 設計が確定。実装開始可能。
- **implementing**: 実装・テスト作業中。
- **done**: 受入条件を満たし、テスト通過。完了。
- **blocked**: 他の要望への依存等で中断中。依存先のREQ番号を記載。

## 要望の粒度ガイドライン

以下を目安に粒度を判断する:

| 粒度 | 例 | 要望ドキュメント |
|---|---|---|
| 大 | 新しいフォーマット定義追加 | 必要 |
| 中 | エンジンへの新型追加（ビットフィールド等） | 必要 |
| 中 | 新しい出力フォーマッター | 必要 |
| 小 | エラーメッセージ改善 | 任意（issueでも可） |
| 小 | 既存テスト追加 | 不要 |

基本方針: **設計判断を伴う変更は要望ドキュメントを作成する**。
