# REQ-032: CSV/TSV出力

## メタ情報

| 項目 | 値 |
|---|---|
| ステータス | done |
| 優先度 | 中 |
| 依存 | なし（REQ-030と組み合わせで価値倍増） |
| 作成日 | 2026-02-06 |
| 更新日 | 2026-02-06 |

## 背景・動機

デコード結果をスプレッドシートや他のツール（pandas, Excel, awk等）で分析したい場合がある:
- ZIPアーカイブの全エントリのファイル名・サイズ・圧縮サイズを一覧表にする
- ELFの全セクションのアドレス・サイズ・フラグを比較する
- 複数バイナリのフィールド値をまとめて集計する

CSV/TSV形式はこれらのツールとの連携に最適なフォーマット。`--filter`（REQ-030）と組み合わせることで「バイナリからデータを抽出するパイプライン」が構築できる。

## 機能要件

### 追加する機能

- [ ] CSV出力フォーマッター（`-o csv`）
  - デコード結果ツリーをフラットなCSV行に変換
  - カラム: path, type, offset, size, value
  - path はドット区切りのフィールドパス（例: `chunks.0.type`）
  - value は型に応じたテキスト表現（整数値、文字列、hex等）
  - ヘッダ行あり
- [ ] TSV出力フォーマッター（`-o tsv`）
  - CSV と同じ構造でタブ区切り
- [ ] 出力オプション
  - 構造体・配列ノードは行を出力するかしないか（リーフのみ or 全ノード）
  - デフォルトはリーフのみ（値を持つフィールドのみ）
- [ ] RFC 4180準拠
  - カンマ・改行・ダブルクォートを含む値の適切なエスケープ

### 変更する既存機能

- [ ] Program.cs: `-o csv` / `-o tsv` 出力形式の追加
- [ ] IOutputFormatter の新しい実装クラス

### 変更しないもの（スコープ外）

- カラムのカスタマイズ（出力カラムの選択・順序変更）— 将来課題
- 複数ファイルの結合出力
- バイナリバイト列のCSV内表現の高度なカスタマイズ

## 受入条件

1. [ ] `-o csv` で有効なCSVが出力されること
2. [ ] `-o tsv` で有効なTSVが出力されること
3. [ ] ヘッダ行に path, type, offset, size, value が含まれること
4. [ ] フィールドパスがドット区切りで正しいこと
5. [ ] 整数値が10進数で出力されること
6. [ ] 文字列値がダブルクォートで囲まれること
7. [ ] カンマを含む値が適切にエスケープされること
8. [ ] 配列要素のパスにインデックスが含まれること（例: `chunks.0.type`）
9. [ ] `--filter` と組み合わせて特定フィールドのみCSV出力できること（REQ-030後）
10. [ ] 既存テストが全て通過すること

## 影響範囲

### 変更が必要なプロジェクト

| プロジェクト | 変更内容の概要 |
|---|---|
| BinAnalyzer.Core | 変更なし |
| BinAnalyzer.Dsl | 変更なし |
| BinAnalyzer.Engine | 変更なし |
| BinAnalyzer.Output | CsvOutputFormatter, TsvOutputFormatter を新規追加 |
| BinAnalyzer.Cli | -o csv / -o tsv の選択肢を追加 |

### 変更が必要なドキュメント

- [ ] docs/cli-usage.md — csv/tsv 出力形式の説明と使用例を追記
- [ ] README.md — 出力形式の数を更新（5種類→7種類）
- [ ] docs/architecture.md — フォーマッター一覧に追記

---

## 設計メモ

> 設計Phaseで記入する。

---

## 実装メモ

> 実装Phaseで記入する。

### 実装中の設計変更

### 追加したテスト

| テストクラス | テスト名 | 対応する受入条件 |
|---|---|---|
| | | |

### 気づき・今後の課題
