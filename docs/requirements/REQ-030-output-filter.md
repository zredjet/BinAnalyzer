# REQ-030: 出力フィルタ（--filter オプション）

## メタ情報

| 項目 | 値 |
|---|---|
| ステータス | done |
| 優先度 | 高 |
| 依存 | なし |
| 作成日 | 2026-02-06 |
| 更新日 | 2026-02-06 |

## 背景・動機

大きなバイナリファイル（数百チャンクのPNG、多数エントリのZIP、ELFの全セクション等）を解析すると、出力が膨大になり目的のフィールドを見つけにくい。

`--filter` オプションで特定のフィールドパスだけを抽出表示できれば:
- 「全チャンクのtype名だけを一覧したい」
- 「IHDRのwidthとheightだけを見たい」
- 「全エントリのファイル名を抽出したい」

といった日常的なユースケースに対応できる。CSV出力（REQ-032）と組み合わせれば、バイナリからのデータ抽出パイプラインが構築できる。

## 機能要件

### 追加する機能

- [ ] `--filter` CLIオプション
  - フィールドパスパターンを指定して出力を絞り込む
  - パス区切りは `.`（ドット）
  - ワイルドカード `*` は任意の1階層にマッチ
  - ワイルドカード `**` は任意の0階層以上にマッチ
  - 複数指定可能（`--filter "a.b" --filter "c.d"`、OR結合）
- [ ] パスパターンの例
  - `chunks.*.type` — 全チャンクのtypeフィールド
  - `**.width` — 任意の深さのwidthフィールド
  - `chunks.0.data` — 最初のチャンクのdata
  - `header.*` — header直下の全フィールド
- [ ] 全出力形式での動作
  - tree: マッチしたフィールドとその祖先のみ表示
  - json: マッチしたフィールドのみ含むJSON
  - csv: マッチしたフィールドのみ出力
  - hexdump/html/map: マッチしたフィールドをハイライト（または絞り込み）

### 変更する既存機能

- [ ] Program.cs: `--filter` オプションの追加
- [ ] 各出力フォーマッター: フィルタ適用ロジックの追加

### 変更しないもの（スコープ外）

- 値に基づくフィルタ（`--filter "type == 'IHDR'"` のような条件式）— 将来課題
- 正規表現パターン
- フィルタ結果のバイナリ書き出し

## 受入条件

1. [ ] `--filter "path"` で指定パスのフィールドのみが出力されること
2. [ ] `*` ワイルドカードが任意の1階層にマッチすること
3. [ ] `**` ワイルドカードが任意の0階層以上にマッチすること
4. [ ] 複数の `--filter` がOR結合で動作すること
5. [ ] tree出力でマッチフィールドの祖先構造が保持されること
6. [ ] json出力でマッチフィールドのみ含むJSONが生成されること
7. [ ] フィルタにマッチするフィールドがない場合に空出力（エラーではない）になること
8. [ ] 配列要素のインデックス指定（`chunks.0`）が動作すること
9. [ ] フィルタなしの場合は従来通り全フィールドが出力されること
10. [ ] 既存テストが全て通過すること

## 影響範囲

### 変更が必要なプロジェクト

| プロジェクト | 変更内容の概要 |
|---|---|
| BinAnalyzer.Core | フィルタパスのパーサーとマッチャーを追加 |
| BinAnalyzer.Dsl | 変更なし |
| BinAnalyzer.Engine | 変更なし |
| BinAnalyzer.Output | 各フォーマッターにフィルタ適用ロジックを追加 |
| BinAnalyzer.Cli | --filter オプションを追加 |

### 変更が必要なドキュメント

- [ ] docs/cli-usage.md — --filter オプションの説明と使用例を追記
- [ ] README.md — 機能一覧に出力フィルタを追記

---

## 設計メモ

> 設計Phaseで記入する。

---

## 実装メモ

> 実装Phaseで記入する。

### 実装中の設計変更

### 追加したテスト

| テストクラス | テスト名 | 対応する受入条件 |
|---|---|---|
| | | |

### 気づき・今後の課題
